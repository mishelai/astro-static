---
interface Props {
  showAll?: boolean;
}

const { showAll = false } = Astro.props;
const base = import.meta.env.BASE_URL;

const services = [
  {
    id: 'emergency',
    icon: 'emergency',
    title: 'Emergency Repairs',
    description: '24/7 rapid response for burst pipes, severe leaks, and urgent plumbing emergencies.',
    features: ['30-min response', 'Available 24/7', 'No extra charges'],
  },
  {
    id: 'drain',
    icon: 'drain',
    title: 'Drain Cleaning',
    description: 'Advanced hydro-jetting and drain cleaning to eliminate stubborn clogs.',
    features: ['Camera inspection', 'Hydro-jetting', 'Preventive care'],
  },
  {
    id: 'water-heater',
    icon: 'heater',
    title: 'Water Heaters',
    description: 'Expert installation, repair, and maintenance for all water heater types.',
    features: ['Tankless options', 'Energy efficient', 'Same-day service'],
  },
  {
    id: 'pipes',
    icon: 'pipes',
    title: 'Pipe Services',
    description: 'Complete pipe installation, repair, and repiping for homes and businesses.',
    features: ['Copper & PEX', 'Leak repair', 'Full repiping'],
  },
  {
    id: 'bathroom',
    icon: 'bathroom',
    title: 'Bathroom Remodel',
    description: 'Transform your bathroom with expert fixture installation and plumbing.',
    features: ['Design consult', 'Fixture install', 'Full renovation'],
  },
  {
    id: 'leak',
    icon: 'leak',
    title: 'Leak Detection',
    description: 'State-of-the-art technology to locate hidden leaks and prevent damage.',
    features: ['Non-invasive', 'Thermal imaging', 'Precise location'],
  },
];

const displayServices = showAll ? services : services.slice(0, 6);

const iconPaths: Record<string, string> = {
  emergency: `<path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/><path d="M12 22V12" stroke-dasharray="2 2"/>`,
  drain: `<circle cx="12" cy="12" r="10"/><path d="M12 6v6l3 3"/><path d="M8 8h.01"/><path d="M16 8h.01"/>`,
  heater: `<rect x="4" y="2" width="16" height="20" rx="2"/><path d="M8 6h8"/><path d="M8 10h8"/><circle cx="12" cy="16" r="2"/><path d="M10 16c0-1.1.9-2 2-2s2 .9 2 2" stroke-dasharray="1 1"/>`,
  pipes: `<path d="M4 4v16"/><path d="M4 12h16"/><path d="M20 4v16"/><circle cx="4" cy="4" r="2"/><circle cx="4" cy="20" r="2"/><circle cx="20" cy="4" r="2"/><circle cx="20" cy="20" r="2"/>`,
  bathroom: `<path d="M3 12h18"/><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7"/><path d="M4 12V7a2 2 0 0 1 2-2h1"/><circle cx="12" cy="7" r="3"/><path d="M12 4v0"/>`,
  leak: `<path d="M12 2c-4.97 0-9 4.03-9 9 0 3.53 2.04 6.58 5 8.05V22l3-3 3 3v-2.95c2.96-1.47 5-4.52 5-8.05 0-4.97-4.03-9-9-9z"/><path d="M12 6v4"/><circle cx="12" cy="14" r="1"/>`,
};
---

<section class="services-section section" id="services">
  <div class="container">
    <!-- Section Header -->
    <div class="section-header" data-animate>
      <div class="section-label">
        <span class="badge">Our Services</span>
      </div>
      <h2 class="section-title">
        Professional plumbing<br/>
        <span class="text-gradient">solutions</span> for every need
      </h2>
      <p class="section-subtitle">
        From emergency repairs to complete renovations, our certified team
        delivers excellence on every job.
      </p>
    </div>

    <!-- Services Grid -->
    <div class="services-grid">
      {displayServices.map((service, index) => (
        <div
          class="service-card"
          id={service.id}
          data-animate
          style={`--delay: ${index * 0.1}s`}
        >
          <div class="card-inner">
            <!-- Icon -->
            <div class="service-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" set:html={iconPaths[service.icon]} />
            </div>

            <!-- Content -->
            <h3 class="service-title">{service.title}</h3>
            <p class="service-desc">{service.description}</p>

            <!-- Features -->
            <ul class="service-features">
              {service.features.map((feature) => (
                <li>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                  <span>{feature}</span>
                </li>
              ))}
            </ul>

            <!-- Link -->
            <a href={`${base}services#${service.id}`} class="service-link">
              <span>Learn more</span>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </a>
          </div>

          <!-- Decorative Corner -->
          <div class="card-corner"></div>
        </div>
      ))}
    </div>

    <!-- CTA -->
    <div class="services-cta" data-animate>
      <a href={`${base}services`} class="btn btn-secondary">
        View All Services
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Background Decoration -->
  <div class="services-bg">
    <div class="bg-grid"></div>
    <div class="bg-gradient"></div>
  </div>
</section>

<style>
  .services-section {
    position: relative;
    background: var(--cream);
    overflow: hidden;
  }

  .services-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .bg-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(200, 121, 65, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(200, 121, 65, 0.03) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  .bg-gradient {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 400px;
    background: linear-gradient(to bottom, rgba(250, 248, 245, 1), transparent);
  }

  .section-header {
    position: relative;
    z-index: 1;
    text-align: center;
    margin-bottom: var(--space-3xl);
  }

  .section-title {
    margin-top: var(--space-md);
  }

  /* Services Grid */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-lg);
    position: relative;
    z-index: 1;
  }

  /* Service Card */
  .service-card {
    position: relative;
    background: var(--white);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: var(--transition);
    opacity: 0;
    transform: translateY(30px);
    transition-delay: var(--delay);
  }

  .service-card.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .service-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
  }

  .card-inner {
    padding: var(--space-xl);
    position: relative;
    z-index: 1;
  }

  .card-corner {
    position: absolute;
    top: 0;
    right: 0;
    width: 80px;
    height: 80px;
    background: var(--gradient-copper);
    opacity: 0;
    clip-path: polygon(100% 0, 0 0, 100% 100%);
    transition: var(--transition);
  }

  .service-card:hover .card-corner {
    opacity: 0.1;
  }

  /* Icon */
  .service-icon {
    width: 64px;
    height: 64px;
    background: rgba(200, 121, 65, 0.08);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--copper);
    margin-bottom: var(--space-lg);
    transition: var(--transition);
  }

  .service-card:hover .service-icon {
    background: var(--gradient-copper);
    color: var(--white);
    transform: scale(1.1);
  }

  /* Title & Description */
  .service-title {
    font-family: var(--font-display);
    font-size: 1.35rem;
    font-weight: 700;
    color: var(--navy);
    margin-bottom: var(--space-sm);
  }

  .service-desc {
    font-size: 0.95rem;
    color: var(--slate);
    line-height: 1.6;
    margin-bottom: var(--space-lg);
  }

  /* Features */
  .service-features {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
  }

  .service-features li {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 0.85rem;
    color: var(--slate-dark);
  }

  .service-features svg {
    color: var(--copper);
    flex-shrink: 0;
  }

  /* Link */
  .service-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--copper);
    transition: var(--transition);
  }

  .service-link svg {
    transition: var(--transition);
  }

  .service-link:hover {
    color: var(--copper-dark);
  }

  .service-link:hover svg {
    transform: translateX(4px);
  }

  /* CTA */
  .services-cta {
    display: flex;
    justify-content: center;
    margin-top: var(--space-3xl);
    position: relative;
    z-index: 1;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .services-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .services-grid {
      grid-template-columns: 1fr;
    }

    .card-inner {
      padding: var(--space-lg);
    }
  }
</style>
